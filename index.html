<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>9Cloud Teamwork Dashboard</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚òÅÔ∏è</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', system-ui, sans-serif; }
    .dashboard { min-height: 100vh; background: linear-gradient(135deg, #0c1222 0%, #1a1f35 100%); color: #e2e8f0; }
    
    .header { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(99, 102, 241, 0.2); padding: 20px 32px; position: sticky; top: 0; z-index: 100; }
    .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1600px; margin: 0 auto; flex-wrap: wrap; gap: 16px; }
    .logo-section { display: flex; align-items: center; gap: 16px; }
    .logo { width: 48px; height: 48px; background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .title { font-size: 24px; font-weight: 700; background: linear-gradient(90deg, #06b6d4, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { color: #64748b; font-size: 13px; margin-top: 2px; }
    .header-stats { display: flex; gap: 12px; }
    .stat-badge { display: flex; flex-direction: column; align-items: center; padding: 10px 18px; background: rgba(99, 102, 241, 0.1); border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.2); }
    .stat-number { font-size: 22px; font-weight: 700; color: #06b6d4; }
    .stat-label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
    
    .main-content { max-width: 1600px; margin: 0 auto; padding: 24px 32px; }
    
    .filters-card { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(99, 102, 241, 0.15); padding: 24px; margin-bottom: 24px; }
    .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
    .filter-group { display: flex; flex-direction: column; gap: 10px; }
    .filter-label { font-size: 11px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
    .toggle-group { display: flex; background: rgba(15, 23, 42, 0.6); border-radius: 12px; padding: 4px; border: 1px solid rgba(99, 102, 241, 0.1); }
    .toggle-btn { flex: 1; padding: 12px 20px; border: none; border-radius: 10px; background: transparent; color: #64748b; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; font-family: inherit; }
    .toggle-btn:hover { color: #e2e8f0; }
    .toggle-btn.active { background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%); color: white; box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3); }
    .select { padding: 12px 16px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 12px; color: #e2e8f0; font-size: 14px; cursor: pointer; outline: none; width: 100%; font-family: inherit; transition: all 0.2s; }
    .select:hover, .select:focus { border-color: #06b6d4; }
    .select option { background: #1e293b; color: #e2e8f0; }
    .date-inputs { display: flex; align-items: center; gap: 8px; }
    .date-input { flex: 1; padding: 12px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 12px; color: #e2e8f0; font-size: 13px; outline: none; font-family: inherit; }
    .date-input:hover, .date-input:focus { border-color: #06b6d4; }
    .date-separator { color: #64748b; font-size: 12px; }
    
    .stats-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px; }
    @media (max-width: 1200px) { .stats-row { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { .stats-row { grid-template-columns: repeat(2, 1fr); } .header-content { justify-content: center; text-align: center; } .logo-section { flex-direction: column; } }
    .stats-card { display: flex; align-items: center; gap: 16px; padding: 20px; background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border-radius: 16px; border: 1px solid rgba(99, 102, 241, 0.1); transition: all 0.3s ease; }
    .stats-card:hover { transform: translateY(-2px); border-color: rgba(99, 102, 241, 0.3); }
    .stats-card.cyan { border-left: 4px solid #06b6d4; }
    .stats-card.green { border-left: 4px solid #10b981; }
    .stats-card.amber { border-left: 4px solid #f59e0b; }
    .stats-card.red { border-left: 4px solid #ef4444; }
    .stats-card.purple { border-left: 4px solid #8b5cf6; }
    .stats-icon { font-size: 32px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)); }
    .stats-value { font-size: 32px; font-weight: 700; color: #f1f5f9; }
    .stats-label { font-size: 12px; color: #64748b; margin-top: 2px; }
    
    .content-grid { display: grid; grid-template-columns: 1fr 420px; gap: 24px; }
    @media (max-width: 1100px) { .content-grid { grid-template-columns: 1fr; } }
    
    .card { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(99, 102, 241, 0.1); padding: 24px; }
    .card-title { font-size: 16px; font-weight: 600; color: #f1f5f9; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
    .task-count { font-size: 11px; padding: 4px 12px; background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%); color: white; border-radius: 20px; font-weight: 600; }
    
    .chart-container { height: 380px; }
    .chart-legend { display: flex; justify-content: center; gap: 24px; margin-top: 16px; flex-wrap: wrap; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #94a3b8; }
    .legend-dot { width: 12px; height: 12px; border-radius: 4px; }
    
    .task-list { display: flex; flex-direction: column; gap: 12px; max-height: 440px; overflow-y: auto; padding-right: 8px; }
    .task-list::-webkit-scrollbar { width: 6px; }
    .task-list::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.3); border-radius: 3px; }
    .task-list::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 3px; }
    .task-item { padding: 16px; background: rgba(15, 23, 42, 0.4); border-radius: 14px; border: 1px solid rgba(99, 102, 241, 0.1); transition: all 0.2s ease; }
    .task-item:hover { border-color: rgba(99, 102, 241, 0.3); transform: translateX(4px); }
    .task-header { display: flex; align-items: flex-start; gap: 12px; }
    .task-status { width: 24px; height: 24px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #fff; flex-shrink: 0; font-weight: 600; }
    .task-status.complete { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .task-status.overdue { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .task-status.active { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .task-name { font-size: 14px; font-weight: 500; color: #f1f5f9; line-height: 1.5; }
    .task-meta { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; padding-left: 36px; }
    .task-project { font-size: 11px; color: #06b6d4; background: rgba(6, 182, 212, 0.15); padding: 4px 10px; border-radius: 8px; font-weight: 500; }
    .task-assignee, .task-due { font-size: 12px; color: #94a3b8; }
    .no-data { display: flex; align-items: center; justify-content: center; height: 200px; color: #64748b; font-size: 14px; }
    
    .footer { text-align: center; padding: 24px; color: #475569; font-size: 13px; border-top: 1px solid rgba(99, 102, 241, 0.1); margin-top: 32px; }
    .footer span { color: #06b6d4; }
    
    .pie-section { display: flex; align-items: center; justify-content: center; gap: 24px; margin-bottom: 24px; }
    .pie-container { width: 140px; height: 140px; }
    .pie-legend { display: flex; flex-direction: column; gap: 8px; }
    .pie-legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #94a3b8; }
    .pie-legend-dot { width: 10px; height: 10px; border-radius: 3px; }
    
    .loading-container { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0c1222 0%, #1a1f35 100%); color: #94a3b8; }
    .spinner { width: 56px; height: 56px; border: 4px solid rgba(99, 102, 241, 0.2); border-top: 4px solid #06b6d4; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-text { font-size: 16px; color: #94a3b8; }
    
    .error-container { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0c1222 0%, #1a1f35 100%); color: #f1f5f9; text-align: center; padding: 24px; }
    .error-icon { font-size: 56px; margin-bottom: 20px; }
    .error-title { color: #ef4444; font-size: 24px; margin-bottom: 12px; }
    .error-text { color: #94a3b8; max-width: 500px; line-height: 1.6; }
    .retry-btn { margin-top: 24px; padding: 14px 32px; background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%); border: none; border-radius: 12px; color: white; font-size: 15px; font-weight: 600; cursor: pointer; font-family: inherit; transition: transform 0.2s, box-shadow 0.2s; }
    .retry-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3); }
    
    .refresh-btn { padding: 10px 20px; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; color: #06b6d4; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .refresh-btn:hover { background: rgba(99, 102, 241, 0.2); }
    .last-updated { font-size: 12px; color: #64748b; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, PieChart, Pie } = Recharts;

    const COLORS = ['#06b6d4', '#8b5cf6', '#f59e0b', '#10b981', '#ef4444', '#ec4899', '#6366f1', '#14b8a6', '#84cc16', '#f97316'];

    // API fetch function
    const fetchTeamworkData = async (endpoint) => {
      const response = await fetch(`/api/teamwork?endpoint=${encodeURIComponent(endpoint)}`);
      if (!response.ok) throw new Error(`Failed to fetch ${endpoint}`);
      return response.json();
    };

    function TeamworkDashboard() {
      const [data, setData] = useState({ projects: [], people: [], tasks: [], timeEntries: [] });
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [lastUpdated, setLastUpdated] = useState(null);
      
      const [viewMode, setViewMode] = useState('staff');
      const [selectedProject, setSelectedProject] = useState('all');
      const [selectedStaff, setSelectedStaff] = useState('all');
      const [dateRange, setDateRange] = useState({ start: '', end: '' });

      const loadData = async () => {
        setLoading(true);
        setError(null);
        try {
          const [projectsData, peopleData, tasksData, timeData] = await Promise.all([
            fetchTeamworkData('projects.json'),
            fetchTeamworkData('people.json'),
            fetchTeamworkData('tasks.json?pageSize=500'),
            fetchTeamworkData('time_entries.json?pageSize=500')
          ]);

          setData({
            projects: projectsData.projects || [],
            people: (peopleData.people || []).filter(p => p['user-type'] !== 'contact'),
            tasks: tasksData['todo-items'] || [],
            timeEntries: timeData['time-entries'] || []
          });
          setLastUpdated(new Date());
          setLoading(false);
        } catch (err) {
          console.error('Error loading data:', err);
          setError(err.message);
          setLoading(false);
        }
      };

      useEffect(() => { loadData(); }, []);

      const { projects, people, tasks, timeEntries } = data;

      const filteredTasks = useMemo(() => tasks.filter(task => {
        if (selectedProject !== 'all' && String(task['project-id']) !== selectedProject) return false;
        if (selectedStaff !== 'all' && !(task['responsible-party-ids'] || '').includes(selectedStaff)) return false;
        if (dateRange.start && task['due-date']) {
          const dueDate = new Date(task['due-date'].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3'));
          if (dueDate < new Date(dateRange.start)) return false;
        }
        if (dateRange.end && task['due-date']) {
          const dueDate = new Date(task['due-date'].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3'));
          if (dueDate > new Date(dateRange.end)) return false;
        }
        return true;
      }), [tasks, selectedProject, selectedStaff, dateRange]);

      const filteredTimeEntries = useMemo(() => timeEntries.filter(entry => {
        if (selectedProject !== 'all' && String(entry['project-id']) !== selectedProject) return false;
        if (selectedStaff !== 'all' && entry['person-id'] !== selectedStaff) return false;
        return true;
      }), [timeEntries, selectedProject, selectedStaff]);

      const workloadData = useMemo(() => {
        if (viewMode === 'staff') {
          const staffData = {};
          people.forEach(person => {
            staffData[person.id] = { name: person['first-name'], fullName: person['full-name'], tasks: 0, hours: 0 };
          });
          filteredTasks.forEach(task => {
            const ids = (task['responsible-party-ids'] || '').split(',');
            ids.forEach(id => { if (staffData[id]) staffData[id].tasks++; });
          });
          filteredTimeEntries.forEach(entry => {
            if (staffData[entry['person-id']]) staffData[entry['person-id']].hours += parseFloat(entry.hoursDecimal) || 0;
          });
          return Object.values(staffData).filter(d => d.tasks > 0 || d.hours > 0).sort((a, b) => b.hours - a.hours);
        } else {
          const projectData = {};
          projects.forEach(proj => {
            projectData[proj.id] = { name: proj.name?.length > 25 ? proj.name.substring(0, 25) + '...' : proj.name, fullName: proj.name, tasks: 0, hours: 0 };
          });
          filteredTasks.forEach(task => {
            const projId = String(task['project-id']);
            if (projectData[projId]) projectData[projId].tasks++;
          });
          filteredTimeEntries.forEach(entry => {
            const projId = String(entry['project-id']);
            if (projectData[projId]) projectData[projId].hours += parseFloat(entry.hoursDecimal) || 0;
          });
          return Object.values(projectData).filter(d => d.tasks > 0 || d.hours > 0).sort((a, b) => b.hours - a.hours).slice(0, 12);
        }
      }, [viewMode, people, projects, filteredTasks, filteredTimeEntries]);

      const tasksByStatus = useMemo(() => ({
        completed: filteredTasks.filter(t => t.completed).length,
        active: filteredTasks.filter(t => !t.completed).length,
        overdue: filteredTasks.filter(t => {
          if (!t['due-date'] || t.completed) return false;
          const due = new Date(t['due-date'].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3'));
          return due < new Date();
        }).length
      }), [filteredTasks]);

      const totalHours = filteredTimeEntries.reduce((sum, e) => sum + (parseFloat(e.hoursDecimal) || 0), 0);

      const pieData = [
        { name: 'Completed', value: tasksByStatus.completed, color: '#10b981' },
        { name: 'Active', value: tasksByStatus.active - tasksByStatus.overdue, color: '#f59e0b' },
        { name: 'Overdue', value: tasksByStatus.overdue, color: '#ef4444' }
      ].filter(d => d.value > 0);

      if (loading) {
        return (
          <div className="loading-container">
            <div className="spinner"></div>
            <p className="loading-text">Connecting to Teamwork...</p>
          </div>
        );
      }

      if (error) {
        return (
          <div className="error-container">
            <div className="error-icon">‚ö†Ô∏è</div>
            <h2 className="error-title">Connection Error</h2>
            <p className="error-text">{error}</p>
            <button className="retry-btn" onClick={loadData}>üîÑ Try Again</button>
          </div>
        );
      }

      return (
        <div className="dashboard">
          <header className="header">
            <div className="header-content">
              <div className="logo-section">
                <div className="logo">‚òÅÔ∏è</div>
                <div>
                  <h1 className="title">9Cloud Teamwork Dashboard</h1>
                  <p className="subtitle">Task & Time Tracking Overview</p>
                </div>
              </div>
              <div className="header-stats">
                <div className="stat-badge">
                  <span className="stat-number">{projects.length}</span>
                  <span className="stat-label">Projects</span>
                </div>
                <div className="stat-badge">
                  <span className="stat-number">{people.length}</span>
                  <span className="stat-label">Staff</span>
                </div>
                <button className="refresh-btn" onClick={loadData}>üîÑ Refresh</button>
              </div>
            </div>
          </header>

          <div className="main-content">
            <div className="filters-card">
              <div className="filters-grid">
                <div className="filter-group">
                  <label className="filter-label">View By</label>
                  <div className="toggle-group">
                    <button className={`toggle-btn ${viewMode === 'project' ? 'active' : ''}`} onClick={() => setViewMode('project')}>üìÅ Project</button>
                    <button className={`toggle-btn ${viewMode === 'staff' ? 'active' : ''}`} onClick={() => setViewMode('staff')}>üë§ Staff</button>
                  </div>
                </div>

                <div className="filter-group">
                  <label className="filter-label">Project</label>
                  <select className="select" value={selectedProject} onChange={(e) => setSelectedProject(e.target.value)}>
                    <option value="all">All Projects</option>
                    {projects.filter(p => p.status === 'active').map(proj => (
                      <option key={proj.id} value={proj.id}>{proj.name}</option>
                    ))}
                  </select>
                </div>

                <div className="filter-group">
                  <label className="filter-label">Staff Member</label>
                  <select className="select" value={selectedStaff} onChange={(e) => setSelectedStaff(e.target.value)}>
                    <option value="all">All Staff</option>
                    {people.map(person => (
                      <option key={person.id} value={person.id}>{person['full-name']}</option>
                    ))}
                  </select>
                </div>

                <div className="filter-group">
                  <label className="filter-label">Date Range</label>
                  <div className="date-inputs">
                    <input type="date" className="date-input" value={dateRange.start} onChange={(e) => setDateRange(prev => ({ ...prev, start: e.target.value }))} />
                    <span className="date-separator">‚Üí</span>
                    <input type="date" className="date-input" value={dateRange.end} onChange={(e) => setDateRange(prev => ({ ...prev, end: e.target.value }))} />
                  </div>
                </div>
              </div>
            </div>

            <div className="stats-row">
              <div className="stats-card cyan">
                <div className="stats-icon">üìã</div>
                <div><div className="stats-value">{filteredTasks.length}</div><div className="stats-label">Total Tasks</div></div>
              </div>
              <div className="stats-card green">
                <div className="stats-icon">‚úÖ</div>
                <div><div className="stats-value">{tasksByStatus.completed}</div><div className="stats-label">Completed</div></div>
              </div>
              <div className="stats-card amber">
                <div className="stats-icon">‚è≥</div>
                <div><div className="stats-value">{tasksByStatus.active - tasksByStatus.overdue}</div><div className="stats-label">In Progress</div></div>
              </div>
              <div className="stats-card red">
                <div className="stats-icon">üö®</div>
                <div><div className="stats-value">{tasksByStatus.overdue}</div><div className="stats-label">Overdue</div></div>
              </div>
              <div className="stats-card purple">
                <div className="stats-icon">‚è±Ô∏è</div>
                <div><div className="stats-value">{totalHours.toFixed(1)}h</div><div className="stats-label">Hours Logged</div></div>
              </div>
            </div>

            <div className="content-grid">
              <div className="card">
                <h3 className="card-title">üìä Workload by {viewMode === 'staff' ? 'Staff Member' : 'Project'}</h3>
                <div className="chart-container">
                  {workloadData.length > 0 ? (
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={workloadData} layout="vertical" margin={{ top: 10, right: 30, left: 120, bottom: 10 }}>
                        <CartesianGrid strokeDasharray="3 3" stroke="rgba(99, 102, 241, 0.1)" horizontal={true} vertical={false} />
                        <XAxis type="number" stroke="#64748b" fontSize={12} tickLine={false} axisLine={{ stroke: 'rgba(99, 102, 241, 0.2)' }} />
                        <YAxis dataKey="name" type="category" stroke="#94a3b8" fontSize={13} width={110} tickLine={false} axisLine={false} />
                        <Tooltip
                          contentStyle={{ backgroundColor: 'rgba(15, 23, 42, 0.95)', border: '1px solid rgba(99, 102, 241, 0.3)', borderRadius: '12px', color: '#f1f5f9', boxShadow: '0 10px 40px rgba(0,0,0,0.3)' }}
                          formatter={(value, name) => [name === 'hours' ? `${value.toFixed(1)} hours` : `${value} tasks`, name === 'hours' ? '‚è±Ô∏è Hours' : 'üìã Tasks']}
                          labelFormatter={(label, payload) => payload[0]?.payload?.fullName || label}
                          cursor={{ fill: 'rgba(99, 102, 241, 0.1)' }}
                        />
                        <Bar dataKey="hours" name="hours" radius={[0, 8, 8, 0]} barSize={28}>
                          {workloadData.map((entry, index) => (
                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                          ))}
                        </Bar>
                      </BarChart>
                    </ResponsiveContainer>
                  ) : (
                    <div className="no-data">No data matches your filters</div>
                  )}
                </div>
                <div className="chart-legend">
                  <span className="legend-item"><span className="legend-dot" style={{background: '#06b6d4'}}></span>Hours Logged</span>
                </div>
              </div>

              <div className="card">
                <h3 className="card-title">üìù Tasks <span className="task-count">{filteredTasks.length}</span></h3>
                
                {pieData.length > 0 && (
                  <div className="pie-section">
                    <div className="pie-container">
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart>
                          <Pie data={pieData} cx="50%" cy="50%" innerRadius={40} outerRadius={60} paddingAngle={3} dataKey="value">
                            {pieData.map((entry, index) => (
                              <Cell key={`cell-${index}`} fill={entry.color} />
                            ))}
                          </Pie>
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                    <div className="pie-legend">
                      {pieData.map((item, i) => (
                        <div key={i} className="pie-legend-item">
                          <span className="pie-legend-dot" style={{background: item.color}}></span>
                          {item.name}: {item.value}
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="task-list">
                  {filteredTasks.slice(0, 15).map((task) => {
                    const isOverdue = task['due-date'] && !task.completed && new Date(task['due-date'].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')) < new Date();
                    return (
                      <div key={task.id} className="task-item">
                        <div className="task-header">
                          <span className={`task-status ${task.completed ? 'complete' : isOverdue ? 'overdue' : 'active'}`}>
                            {task.completed ? '‚úì' : isOverdue ? '!' : '‚óã'}
                          </span>
                          <span className="task-name">{task.content}</span>
                        </div>
                        <div className="task-meta">
                          <span className="task-project">{task['project-name']}</span>
                          {task['responsible-party-summary'] && <span className="task-assignee">üë§ {task['responsible-party-summary']}</span>}
                          {task['due-date'] && <span className="task-due">üìÖ {task['due-date'].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')}</span>}
                        </div>
                      </div>
                    );
                  })}
                  {filteredTasks.length === 0 && <div className="no-data">No tasks match your filters</div>}
                </div>
              </div>
            </div>

            <footer className="footer">
              <p>Connected to <span>9cloudwebworks.teamwork.com</span> {lastUpdated && <> ‚Ä¢ Last updated: {lastUpdated.toLocaleString()}</>}</p>
            </footer>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TeamworkDashboard />);
  </script>
</body>
</html>
